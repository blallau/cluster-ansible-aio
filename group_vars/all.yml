---

#####################
# guest description #
#####################
node_prefix: ""
guest_os_distro: "{{ ansible_distribution | lower }}"
os_default_user: "{{ guest_os_distro }}"
guest_timezone: "UTC"
qemu_guest_agent_enabled: True

# Flatcar stuff
flatcar_update_server_ip: "11.102.100.1"
flatcar_update_server_port: 8000

runtime: "vm"

# controller RAM=8 (10 si elastic)
nodes:
  - name: "controller1"
    type: "controller"
    cpu: 4
    ram: 10
    os_type: "centos"
    net_intfs:
      - name: "{{ net_prefix }}mgmt-br"
      - name: "{{ net_prefix }}api-br"
      - name: "{{ net_prefix }}tunnel-br"
      - name: "{{ net_prefix }}stor-f-br"
      - name: "{{ net_prefix }}stor-b-br"
      - name: "{{ net_prefix }}api-ext-br"
      - name: "{{ net_prefix }}neutron-ext-br"
    disks:
      - name: vol-log
        size: 60
        format: "ext4"
        mount_path: "/logs"
  - name: "networknode1"
    type: "network_node"
    cpu: 1
    ram: 6
    os_type: "centos"
    net_intfs:
      - name: "{{ net_prefix }}mgmt-br"
      - name: "{{ net_prefix }}api-br"
      - name: "{{ net_prefix }}tunnel-br"
      - name: "{{ net_prefix }}stor-f-br"
      - name: "{{ net_prefix }}stor-b-br"
      - name: "{{ net_prefix }}api-ext-br"
      - name: "{{ net_prefix }}neutron-ext-br"
  - name: "compute1"
    type: "compute"
    cpu: 2
    ram: 8
    os_type: "centos"
    net_intfs:
      - name: "{{ net_prefix }}mgmt-br"
      - name: "{{ net_prefix }}api-br"
      - name: "{{ net_prefix }}tunnel-br"
      - name: "{{ net_prefix }}stor-f-br"
      - name: "{{ net_prefix }}stor-b-br"
      - name: "{{ net_prefix }}api-ext-br"
      - name: "{{ net_prefix }}neutron-ext-br"
  - name: "ceph"
    type: "ceph"
    cpu: 1
    ram: 5
    os_type: "centos"
    net_intfs:
      - name: "{{ net_prefix }}mgmt-br"
      - name: "{{ net_prefix }}api-br"
      - name: "{{ net_prefix }}tunnel-br"
      - name: "{{ net_prefix }}stor-f-br"
      - name: "{{ net_prefix }}stor-b-br"
      - name: "{{ net_prefix }}api-ext-br"
      - name: "{{ net_prefix }}neutron-ext-br"
    disks:
      - name: vol-osd1
        size: 40
        type: qcow2
      - name: vol-osd2
        size: 40
        type: qcow2
      - name: vol-osd3
        size: 40
        type: qcow2
      - name: minio
        size: 40
        format: "ext4"
        mount_path: "/opt/minio/data"

# virt-customize
################
virt_customize_packages: []
virt_customize_cmd: []

# Networking
############
# First interface MUST be external one
net_prefix: ""

# note(bl) one NAT interface is required
networks:
  - name: "{{ net_prefix }}mgmt-br"
    forward: nat
    mode: dhcp
    cidr: "11.100.100.0/24"
    pxe: False
  - name: "{{ net_prefix }}api-br"
    mode: dhcp
    cidr: "11.100.110.0/24"
  - name: "{{ net_prefix }}tunnel-br"
    mode: dhcp
    cidr: "11.100.120.0/24"
  - name: "{{ net_prefix }}stor-f-br"
    mode: dhcp
    cidr: "11.100.130.0/24"
  - name: "{{ net_prefix }}stor-b-br"
    mode: dhcp
    cidr: "11.100.140.0/24"
  - name: "{{ net_prefix }}api-ext-br"
    mode: dhcp
    cidr: "11.100.150.0/24"
  - name: "{{ net_prefix }}neutron-ext-br"
    mode: dhcp
    cidr: "11.100.160.0/24"

# note(bl) one NAT interface is required
host_ip: "{{ networks | selectattr('forward', 'defined') | selectattr('forward', 'equalto', 'nat') | map(attribute='cidr') | ipaddr('1') | ipaddr('address') | first }}"

# ip_offset [ 2-9 ]
# advanced use case to avoid IP conflict
#
# with ip_offset IP is define :
#   master node : 10 + ip_offset + outer_master_loop.index
#   woeker nide : 20 + ip_offset + outer_master_loop.index
ip_offset: 8

# Storage
#########
# in Go
root_disk_size: "80"

# Additional disks (LVM)
physical_disks:
  - /dev/nvme0n1p6
virt_volume_group: "virtvg"

# vm_volumes_mount: true
# vm_volumes_mount_path: "/data/kubernetes"

# Globals #
###########
home_dir: "{{ ansible_user_dir }}"
tmp_dir: "{{ home_dir}}/tmp"

############################
# Docker registry defaults #
############################
docker_enabled: "False"
docker_registry_ip: "{{ host_ip }}"
docker_registry_port: 5000
destroy_docker_registry: "False"
registry_enabled: "False"

############################
# Devpi PIP proxy defaults #
############################
pip_cache_enabled: "False"
destroy_pip_cache: "False"
pip_cache_proxy_ip: "{{ host_ip }}"
pip_cache_proxy_port: 3141

############################
# APT cache proxy defaults #
############################
apt_cache_enabled: "False"
destroy_apt_cache: "False"
apt_cache_proxy_ip: "{{ host_ip }}"
apt_cache_proxy_port: 3142

############################
#   DNS server defaults    #
############################
local_dns_enabled: "True"
dns_server_enabled: "False"
destroy_dns_server: "False"

dns_server_proxy_ip: "{{ host_ip }}"
dns_server_port: 53
dns_server_webproc_port: 5380
